# Bumper Goats - UML Class Diagrams

This document contains 3 focused UML class diagrams for the Bumper Goats Unity project.

---

## Diagram 1: Controller System (Player & ML-Agent)

This diagram shows how the player controller and AI controller both use the core `GoatController` component.

```mermaid
classDiagram
    %% Unity Base Classes
    class MonoBehaviour {
        <<Unity>>
    }

    class Agent {
        <<Unity ML-Agents>>
        +Initialize()
        +OnEpisodeBegin()
        +CollectObservations(VectorSensor)
        +OnActionReceived(ActionBuffers)
        +AddReward(float)
        +EndEpisode()
    }

    %% Core Goat Controller (Shared Component)
    class GoatController {
        <<MonoBehaviour>>
        +Move(Vector2)
        +Attack()
        +Dodge(Vector2)
        +Brace(bool)
        +Jump()
        +bool IsGrounded
        +bool IsCharging
        +bool IsBraced
        +bool IsDodging
        +float currentStamina
    }

    %% Player Controller (Human Input)
    class PlayerGoatController {
        <<MonoBehaviour>>
        -GoatController goatController
        -PlayerControls playerControls
        -Vector2 moveDirection
        -OnMove(InputAction.CallbackContext)
        -OnAttack(InputAction.CallbackContext)
        -OnDodge(InputAction.CallbackContext)
        -OnJump(InputAction.CallbackContext)
        -OnBrace(InputAction.CallbackContext)
    }

    %% AI Controller (ML-Agents)
    class AiGoatScript {
        <<Agent>>
        -GoatController goatController
        -GoatController opponentController
        -Transform opponentTransform
        -Transform platformTransform
        +OnActionReceived(ActionBuffers)
        +CollectObservations(VectorSensor)
        +OnAIFellOff()
        +OnPlayerFellOff()
    }

    %% Input System
    class PlayerControls {
        <<Auto-Generated>>
        +InputAction Move
        +InputAction Attack
        +InputAction Dodge
        +InputAction Jump
        +InputAction Brace
    }

    %% Relationships
    MonoBehaviour <|-- GoatController
    MonoBehaviour <|-- PlayerGoatController
    MonoBehaviour <|-- Agent
    Agent <|-- AiGoatScript

    PlayerGoatController --> GoatController : controls
    PlayerGoatController --> PlayerControls : uses input from

    AiGoatScript --> GoatController : controls self
    AiGoatScript --> GoatController : observes opponent
```

### Key Points:

- **GoatController** is the shared core component that handles all goat actions (move, attack, dodge, jump, brace)
- **PlayerGoatController** translates Unity Input System events into GoatController commands
- **AiGoatScript** uses ML-Agents to control the goat via reinforcement learning
- Both controllers use the same GoatController interface, ensuring consistent behavior

---

## Diagram 2: Arena Management System

This diagram shows how the arena shrinking and fall zone detection work together.

```mermaid
classDiagram
    class ArenaShrinking {
        <<MonoBehaviour>>
        <<Singleton>>
        -GameObject arenaObject
        -Vector3 initialScale
        -Vector3 minScale
        -float timer
        +float reduceSpeed
        +float gracePeriod
        +ArenaShrinking Instance
        +ResetArenaSize()
    }

    class FallZoneDetector {
        <<MonoBehaviour>>
        -Transform playerRespawnPoint
        -Transform aiRespawnPoint
        -string playerTag
        -string aiTag
        -OnTriggerEnter(Collider)
        -Respawn(Rigidbody, Transform)
        -ResetStamina(GoatController)
    }

    class GoatController {
        <<MonoBehaviour>>
        +float currentStamina
    }

    class Platform {
        <<GameObject>>
        Tag: "Platform"
    }

    class FallZone {
        <<GameObject>>
        Collider: isTrigger = true
    }

    %% Relationships
    ArenaShrinking --> Platform : shrinks over time
    FallZoneDetector --> GoatController : resets stamina
    FallZoneDetector --> ArenaShrinking : calls ResetArenaSize()
    FallZone --> FallZoneDetector : has component
```

### How It Works:

**Arena Shrinking:**

1. `ArenaShrinking` is a singleton that runs continuously
2. After a grace period (10 seconds), it gradually reduces the platform scale
3. The arena shrinks from `initialScale` down to `minScale`
4. Can be reset via `ResetArenaSize()`

**Fall Zone Detection:**

1. `FallZoneDetector` has a trigger collider below the arena
2. When a goat falls through and enters the trigger:
   - The goat is respawned at its spawn point
   - The goat's stamina is reset to full
   - The arena size is reset via `ArenaShrinking.Instance.ResetArenaSize()`

**Interconnection:**

- These systems are loosely coupled but work together
- FallZoneDetector triggers arena reset when any goat falls
- Both systems operate independently but coordinate through the singleton pattern

---

## Diagram 3: System Interaction Flow

This diagram shows how all major systems interact during gameplay.

```mermaid
graph TB
    subgraph "Input Layer"
        A[Player Input<br/>Keyboard/Controller]
        B[ML-Agents Decision<br/>Neural Network]
    end

    subgraph "Controller Layer"
        C[PlayerGoatController]
        D[AiGoatScript]
    end

    subgraph "Core Gameplay"
        E[GoatController<br/>Player Goat]
        F[GoatController<br/>AI Goat]
    end

    subgraph "Physics & Environment"
        G[Unity Physics<br/>Rigidbody]
        H[Arena Platform]
        I[Fall Zone]
    end

    subgraph "Arena Management"
        J[ArenaShrinking]
        K[FallZoneDetector]
    end

    %% Input to Controllers
    A -->|Input Events| C
    B -->|Actions| D

    %% Controllers to GoatControllers
    C -->|Commands| E
    D -->|Commands| F

    %% GoatControllers to Physics
    E -->|Apply Forces| G
    F -->|Apply Forces| G

    %% Physics Interactions
    G -->|Collision| H
    G -->|Falls Off| I

    %% Arena Management
    J -->|Shrinks| H
    I -->|Trigger| K
    K -->|Reset Arena| J
    K -->|Respawn & Reset Stamina| E
    K -->|Respawn & Reset Stamina| F

    %% AI Observations
    F -.->|Observes| E
    F -.->|Observes| H
```

### System Flow:

1. **Input → Controller**: Human input or AI decisions reach their respective controllers
2. **Controller → GoatController**: Both controllers send commands to their GoatController instance
3. **GoatController → Physics**: Actions apply forces to Rigidbody components
4. **Physics → Environment**: Goats interact with the platform and can fall off
5. **Fall Detection**: When a goat enters the fall zone trigger, FallZoneDetector handles respawn
6. **Arena Reset**: After a fall, the arena size is reset and the cycle continues

---

## Summary

### Diagram 1 - Controller System

Shows the **dual control scheme**: human players use input system → PlayerGoatController → GoatController, while AI uses ML-Agents → AiGoatScript → GoatController.

### Diagram 2 - Arena Management

Shows the **environment systems**: ArenaShrinking progressively shrinks the platform, and FallZoneDetector handles respawns and resets when goats fall.

### Diagram 3 - System Interaction

Shows the **complete gameplay loop**: from input to physics to environment management and back.
